<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>토스 현금영수증 API</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="https://static.toss.im/tds/favicon/favicon.ico" />
    <link rel="icon" type="image/png" sizes="16x16" href="https://static.toss.im/tds/favicon/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="https://static.toss.im/tds/favicon/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="https://static.toss.im/tds/favicon/favicon-48x48.png" />
    <link rel="icon" type="image/png" sizes="196x196" href="https://static.toss.im/tds/favicon/favicon-196x196.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="https://static.toss.im/tds/favicon/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="https://static.toss.im/tds/favicon/apple-touch-icon-72x72.png" />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="https://static.toss.im/tds/favicon/apple-touch-icon-114x114.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="https://static.toss.im/tds/favicon/apple-touch-icon-120x120.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="https://static.toss.im/tds/favicon/apple-touch-icon-144x144.png"  
    />
    <link
      sizes="152x152"
      href="https://static.toss.im/tds/favicon/apple-touch-icon-152x152.png"fdsffsdf
    />
    <meta name="msapplication-TileImage" content="https://static.toss.im/tds/favicon/mstile-144x144.png" />

    <!-- stylesheets -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"
      integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ=="
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="css/prism.css" />
    <link rel="stylesheet" type="text/css" href="css/tossdev.css" />

    <!-- javascript -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"
      integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ=="
      crossorigin="anonymous"
    ></script>
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body id="docs" data-spy="scroll" data-target="#guide">
    <!-- Google Tag Manager -->
    <noscript
      ><iframe
        src="//www.googletagmanager.com/ns.html?id=GTM-TPTMLG"
        height="0"
        width="0"
        style="display:none;visibility:hidden"
      ></iframe
    ></noscript>
    <script>
      (function(w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', 'GTM-TPTMLG');
    </script>
  <!-- End Google Tag Manager -->
    <div id="guide">
      <div class="logo">
        <a href="index.html">
          <img class="logo-img" src="https://static.toss.im/tds/icon/svg/logo-only-icon.svg" alt="">
          <span>결제 연동 가이드</span>
        </a>
      </div>
        <ul class="menu nav">
            <h5>현금영수증 API</h5>
            <li>
                <a href="#intro">소개</a>
            </li>
            <h5>API 목록</h5>
            <li>
                <a href="#issue">현금 영수증 발급</a>
            </li>
            <li>
                <a href="#revoke">현금 영수증 취소</a>
            </li>
            <li>
                <a href="#info">현금 영수증 상태 확인 </a>
            </li>
            <li>
                <a href="#popupUri">현금 영수증 팝업 주소 전달 </a>
            </li>
	    <li>
                <a href="#test">현금 영수증 테스트</a>
            </li>
        </ul>
    </div>
    <div id="api-docs">
      <div id="methods">
        <div class="languages">
          <a class="language selected" data-lang="php" href="#">PHP</a>
          <a class="language" data-lang="java" href="#">Java</a>
          <a class="language" data-lang="curl" href="#">curl</a>
          <a class="language" data-lang="python" href="#">Python</a>
          <a class="language" data-lang="ruby" href="#">Ruby</a>
          <a class="language" data-lang="aspnet" href="#">ASP</a>
        </div>
        <div class="method" id="intro">
          <div class="method-section clearfix">
            <div class="method-description">
              <h3>토스 현금영수증 API 소개</h3>
              <p>
               본 문서는 토스페이 결제 가맹점에서 현금영수증을 발급하거나 취소, 상태 확인 및 현금영수증 이미지 주소를 얻고자 할 때 사용할 API 에 대한 가이드를 제공합니다.<br>
               토스페이 결제 가맹점에서는 해당하는 현금영수증 API 를 이용하여 국세청으로 현금영수증을 등록 및 취소, 상태 확인 등을 할 수 있습니다.<br>
               이를 위해 토스페이에서는 토스페이먼츠(PG)를 통해 가맹점에게 현금영수증 API 를 제공하고,<br> 
	       토스페이먼츠(PG)를 통해 국세청으로 정상 등록이 되면 통상 2일 안에 국세청으로부터 동기화 과정을 거쳐서 현금영수증의 발급이 완료됩니다.
              </p>
            </div>
            </div>
          </div>
        <div class="method" id="issue">
          <div class="method-section clearfix">
            <div class="method-description">
              <h3>현금 영수증 발급</h3>
              <p>
               해당 결제가 status = PAY_COMPLETE 으로 완료되었을 때, 현금 영수증 발급이 가능합니다.
              </p>
              <div class="info">
                <h4>endpoint</h4>
                <div class="field clearfix">
                  <div class="key">
                    (POST)
                  </div>
                  <div class="desc">
                    https://pay.toss.im/api/v2/issue-cash-receipt
                  </div>
                </div>
              </div>
              <div class="info">
                <h4>parameters</h4>
                <div class="field clearfix">
                  <div class="key">
                    apiKey
                  <span class="type">string <font color=#c25300>필수</font></span>
                  <span class="type">Max Length: 255 </span>
                  </div>
                  <div class="desc">
                   결제 가맹점의 apiKey<br/>
                   <span class="text-muted">apiKey 는 LIVE 값만 동작하며 TEST 값은 무시됩니다.
                  </div>
                </div>
		  <div class="field clearfix">
                  <div class="key">
                    payToken
                  <span class="type">string <font color=#c25300>필수</font></span>
                  <span class="type">Max Length: 255 </span>
                  </div>
                  <div class="desc">
                   결제 토큰 <br/>
                   <span class="text-muted">현금영수증 발급 대상 결제는 결제 완료(status = PAY_COMPLETE) 상태여야 합니다.<br></span>
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    cashReceiptKey
                  <span class="type">string <font color=#c25300>필수</font></span>
                  <span class="type">Max Length: 255 </span>
                  </div>
                  <div class="desc">
                    발급 주체를 식별할 수 있는 key 값<br/>
                    <span class="text-muted">ex) 개인의 경우 - 휴대폰번호<br/>
		                                 사업장의 경우 - 사업자등록번호<br></span>
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    cashReceiptKeyType
                  <span class="type">string <font color=#c25300>필수</font></span>
                  <span class="type">Max Length: 255 </span>
                  </div>
                  <div class="desc">
                    현금영수증 keyType<br/>
		  <br/>
                  <table class="table">
                    <tr>
                     <td>PHONE</td>
                      <td>전화번호</td>
                    </tr>
		     <tr>
                     <td>CORPORATE</td>
                      <td>사업자등록번호</td>
                    </tr>
		    <tr>
                     <td>CARD</td>
                      <td>카드번호</td>
                    </tr>
                  </table>
                   </div>
                  </div>
                <div class="field clearfix">
                  <div class="key">
                    cashReceiptPurpose
                  <span class="type">string <font color=#c25300>필수</font></span>
                  <span class="type">Max Length: 255 </span>
                  </div>
                  <div class="desc">
                    현금영수증 발급 목적<br/>
                    <br/>
                    <table class="table">
                      <tr>
                        <td>DEDUCTION</td>
                        <td>소득공제용</td>
                      </tr>
                      <tr>
                        <td>EVIDENCE</td>
                        <td>지출증빙용</td>
                      </tr>
                    </table>
                  </div>
		 </div>
		<div class="field clearfix">
                  <div class="key">
                    needSelfIssue
                  <span class="type">boolean</span>
                  <span class="type">Max Length: 5 </span>
                  </div>
                  <div class="desc">
                    자진발급 처리여부<br/>
                    <span class="text-muted">자진발급 처리를 희망하지 않을 경우, needSelfIssue 파라미터는 전달 하지 않는다. (기본값 false)<br/>
                     * 단, cashReceiptKey, cashReceiptKeyType, cashReceiptPurpose 값들이 반드시 전달 되어야 한다.<br></span>
                   <br/>
                  <span class="text-muted"> 자진발급 처리여부를 true 로 전달 할 경우, 자진발급 처리를 진행 할 수 있으며, 아래와 같이 자동 발행<br/>
                                            (2021년 01월부터 실행된 현금영수증 의무발행 정보에 의거)<br/>
                 * 식별번호(cashReceiptKey): 01000001234<br/>
                 * 현금영수증 타입(cashReceiptKeyType): PHONE (전화번호)<br/>
                 * 발급목적(cashReceiptPurpose): DEDUCTION (소득공제용)<br></span>
                 <br/>
                  </div>
                </div>
              </div>
              <div class="info">
                <h4>response (JSON)</h4>
                <div class="field clearfix">
                  <div class="key">
                    transactionType
                  </div>
                  <div class="desc">
                    거래 종류
                    <br />
                    <br />
                    <table class="table">
                      <tr>
                        <td>PAY</td>
                        <td>결제</td>
                      </tr>
                      <tr>
                        <td>REFUND</td>
                        <td>환불</td>
                      </tr>
                      <tr>
                        <td>FEE</td>
                        <td>환불수수료 등 기타 건</td>
                      </tr>
                    </table>
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    settleDate
                  </div>
                  <div class="desc">
                    거래 승인일
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    dueDate
                  </div>
                  <div class="desc">
                    지급일
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    payToken
                  </div>
                  <div class="desc">
                    Toss 결제 토큰
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    orderNo
                  </div>
                  <div class="desc">
                    가맹점의 상품 주문번호
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    productDesc
                  </div>
                  <div class="desc">
                    상품 설명
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    payMethod
                  </div>
                  <div class="desc">
                    결제 수단
                    <br/>
                    <br/>
                    <table class="table">
                      <tr>
                        <td>TOSS_MONEY</td>
                        <td>토스머니</td>
                      </tr>
                      <tr>
                        <td>CARD</td>
                        <td>카드</td>
                      </tr>
                    </table>
                  </div>
                </div> 
                <div class="field clearfix">
                  <div class="key">
                    amount
                  </div>
                  <div class="desc">금액<br />(결제는 '+', 환불은 '-'로 표시됨)</div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    fee
                  </div>
                  <div class="desc">
                    수수료<br />(수수료 부과는 '-', 전액 환불 등 사유로 수수료를 돌려드리는 경우 '+'로 표시됨)
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    vat
                  </div>
                  <div class="desc">
                    부가세<br />(부가세 부과는 '-', 전액 환불 등 사유로 부가세를 돌려드리는 경우 '+'로 표시됨)
                  </div>
                </div>

                <div class="field clearfix">
                  <div class="key">
                    tossChargeAmount
                  </div>
                  <div class="desc">
                    토스 부담 금액<br />
                  </div>
                </div>

                <div class="field clearfix">
                  <div class="key">
                    rewardReturnAmount
                  </div>
                  <div class="desc">
                    캐시백 회수 금액<br />캐시백 받았던 결제건을 환불했을 때, 환불 결제금액에서 차감될 캐시백 회수 금액
                  </div>
                </div>
                </div>
                    </div>
                    <div class="method-example">
                        <div class="title">Definition</div>
                        <pre><code class="language-bash always-visible">POST https://pay.toss.im/api/v2/payments</code></pre>
                        <div class="title">Example Request</div>
                        <pre><code class="curl language-bash">curl https://pay.toss.im/api/v2/payments \
    -H "Content-Type: application/json" \
    -d '{
        "orderNo":"1",
        "amount":10000,
        "amountTaxFree":0,
        "productDesc":"테스트결제",
        "apiKey":"sk_test_w5lNQylNqa5lNQe013Nq",
        "autoExecute":true,
        "resultCallback":"https://YOUR-SITE.COM/callback",
        "callbackVersion":"V2",
        "retUrl": "http://YOUR-SITE.COM/ORDER-CHECK?orderno=1",
        "retCancelUrl": "http://YOUR-SITE.COM/close"
        }'</code><code class="java language-java">import java.nio.charset.StandardCharsets;

URL url = null;
URLConnection connection = null;
StringBuilder responseBody = new StringBuilder();
try {
	url = new URL("https://pay.toss.im/api/v2/payments");
	connection = url.openConnection();
	connection.addRequestProperty("Content-Type", "application/json");
	connection.setDoOutput(true);
	connection.setDoInput(true);

	org.json.simple.JSONObject jsonBody = new JSONObject();
	jsonBody.put("orderNo", "1");
	jsonBody.put("amount", 10000);
	jsonBody.put("amountTaxFree", 0);
	jsonBody.put("productDesc", "테스트 결제");
	jsonBody.put("apiKey", "sk_test_w5lNQylNqa5lNQe013Nq");
    jsonBody.put("autoExecute", true);
    jsonBody.put("resultCallback", "http://"http://YOUR-SITE.COM/callback");
    jsonBody.put("callbackVersion", "V2");  
    jsonBody.put("retUrl", "http://YOUR-SITE.COM/ORDER-CHECK?orderno=1");
    jsonBody.put("retCancelUrl", "http://YOUR-SITE.COM/close");

	BufferedOutputStream bos = new BufferedOutputStream(connection.getOutputStream());
	<!--bos.write(jsonBody.toJSONString().getBytes());-->
    bos.write(jsonBody.toJSONString().getBytes(StandardCharsets.UTF_8));
	bos.flush();
	bos.close();

	<!--BufferedReader br = new BufferedReader(new InputStreamReader(connection.getInputStream()));-->
    BufferedReader br = new BufferedReader(new InputStreamReader(connection.getInputStream(), StandardCharsets.UTF_8));
	String line = null;
	while ((line = br.readLine()) != null) {
		responseBody.append(line);
	}
	br.close();
} catch (Exception e) {
	responseBody.append(e);
}
System.out.println(responseBody.toString());</code><code class="php language-php">$arrayBody = array();
$arrayBody["orderNo"] = "1";
$arrayBody["amount"] = 10000;
$arrayBody["amountTaxFree"] = 0;
$arrayBody["productDesc"] = "테스트 결제";
$arrayBody["apiKey"] = "sk_test_w5lNQylNqa5lNQe013Nq";
$arrayBody["autoExecute"] = true;
$arrayBody["resultCallback"] = "http://YOUR-SITE.COM/callback";
$arrayBody["callbackVersion"] = "V2";
$arrayBody["retUrl"] = "http://YOUR-SITE.COM/ORDER-CHECK?orderno=1";
$arrayBody["retCancelUrl"] = "http://YOUR-SITE.COM/close";
$jsonBody = json_encode($arrayBody);

$ch = curl_init('https://pay.toss.im/api/v2/payments');
curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
curl_setopt($ch, CURLOPT_POSTFIELDS, $jsonBody);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HTTPHEADER, array(
    'Content-Type: application/json',
    'Content-Length: ' . strlen($jsonBody))
);

$result = curl_exec($ch);
curl_close($ch);

echo "Response: ".$result;</code><code class="aspnet language-aspnet">Dim data, httpRequest, postResponse

data = "apiKey=sk_test_w5lNQylNqa5lNQe013Nq"
data = data & "&orderNo=1"
data = data & "&amount=10000"
data = data & "&amountTaxFree=0"
data = data & "&productDesc=ASPtestProduct"
data = data & "&autoExecute=true"
data = data & "&resultCallback=http://YOUR-SITE.COM/callback"
data = data & "&callbackVersion=V2"
data = data & "&retUrl=http://YOUR-SITE.COM/ORDER-CHECK?orderno=1"
data = data & "&retCancelUrl=http://YOUR-SITE.COM/close"

Set httpRequest = Server.CreateObject("MSXML2.ServerXMLHTTP")
httpRequest.Open "POST", "https://pay.toss.im/api/v2/payments", False
httpRequest.SetRequestHeader "Content-Type", "application/json"
httpRequest.Send data

postResponse = httpRequest.ResponseText

Response.Write postResponse</code><code class="python language-python">import urllib, urllib2

url = "https://pay.toss.im/api/v2/payments"
params = {
    "orderNo": "1",
    "amount": 10000,
    "amountTaxFree": 0,
    "productDesc":"테스트 결제",
    "apiKey": "sk_test_w5lNQylNqa5lNQe013Nq",
    "autoExecute": true,
    "resultCallback": "http://YOUR-SITE.COM/callback",
    "callbackVersion": "V2",
    "retUrl": "http://YOUR-SITE.COM/ORDER-CHECK?orderno=1",
    "retCancelUrl": "http://YOUR-SITE.COM/close"
}

response = urllib.urlopen(url, urllib.urlencode(params))
print(response.read())</code><code class="ruby language-ruby">require 'net/http'
require 'json'

uri = URI.parse("https://pay.toss.im/api/v2/payments")

params = {
        "orderNo" => "1",
        "amount"=> 10000,
        "amountTaxFree"=> 0,
        "productDesc" => "테스트 결제",
        "apiKey" => "sk_test_w5lNQylNqa5lNQe013Nq",
        "autoExecute" => true,
        "resultCallback" => "http://YOUR-SITE.COM/callback",
        "callbackVersion" => "V2",
        "retUrl": "http://YOUR-SITE.COM/ORDER-CHECK?orderno=1",
        "retCancelUrl": "http://YOUR-SITE.COM/close"
}

http = Net::HTTP.new(uri.host, uri.port)
http.use_ssl = true
request = Net::HTTP::Post.new(uri.path)
request.set_form_data(params)
response = http.request(request)

p JSON.parse(response.body)</code></pre>
                        <div class="title">Example Response</div>
                        <pre><div><code style="border:none;box-shadow:none;" class="language-javascript always-visible">{"code":0,"checkoutPage":"https://pay.toss.im/payfront/auth?payToken=example-payToken","payToken":"example-payToken"}
                        </code></div></pre>
                    </div>
                </div>
            </div>
	   <div class="method" id="test">
          <div class="method-section clearfix">
            <div class="method-description">
              <h3>현금 영수증 테스트</h3>
              <div class="info">
                <h4>현금영수증 API 테스트</h4>
                <div class="field clearfix">
                  <div class="key">현금영수증 발급</div>
                  <div class="desc">
                     <form method="post" action="https://pay.toss.im/api/v2/issue-cash-receipt">
        <input type="text" name="apiKey" placeholder="apiKey" required><br>
        <input type="text" name="payToken" placeholder="payToken" required><br>
        <input type="text" name="cashReceiptKey" placeholder="cashReceiptKey" required><br>
        <select name="cashReceiptKeyType" required>
            <option value="PHONE">PHONE</option>
            <option value="CORPORATE">CORPORATE</option>
            <option value="CARD">CARD</option>
        </select><br>
        <select name="cashReceiptPurpose" required>
            <option value="DEDUCTION">DEDUCTION</option>
            <option value="EVIDENCE">EVIDENCE</option>
        </select><br>
        <input type="checkbox" name="needSelfIssue" value="true"> 자진발급 처리여부<br>
        <input type="submit" value="발급 요청">
    </form>
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">현금영수증 취소</div>
                  <div class="desc">
                   <body>
               <form method="post" action="https://pay.toss.im/api/v2/revoke-cash-receipt">
          <input type="text" name="apiKey" placeholder="apiKey" required><br>
        <input type="text" name="payToken" placeholder="payToken" required><br>
        <input type="submit" value="취소 요청">
    </form>
</body>
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">현금영수증 상태 확인</div>
                  <div class="desc">
    <form method="post" action="https://pay.toss.im/api/v2/cash-receipt-info">
        <input type="text" name="apiKey" placeholder="apiKey" required><br>
        <input type="text" name="payToken" placeholder="payToken" required><br>
        <input type="submit" value="상태 확인 요청">
    </form>
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">현금영수증 팝업 주소 전달</div>
                  <div class="desc">
                       <form method="post" action="https://pay.toss.im/api/v2/cash-receipt-popupUri">
        <input type="text" name="apiKey" placeholder="apiKey" required><br>
        <input type="text" name="payToken" placeholder="payToken" required><br>
        <input type="submit" value="팝업 주소 전달 요청">
    </form>
                  </div>
                </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="method-example">
              <pre>
              <code class="curl">
              </code>
              <code class="java">
              </code>
              <code class="pho">
              </code>
            </pre>
            </div>
	<div id="methods">
        <div class="languages">
          <a class="language selected" data-lang="php" href="#">PHP</a>
          <a class="language" data-lang="java" href="#">Java</a>
          <a class="language" data-lang="curl" href="#">curl</a>
          <a class="language" data-lang="python" href="#">Python</a>
          <a class="language" data-lang="ruby" href="#">Ruby</a>
          <a class="language" data-lang="aspnet" href="#">ASP</a>
        </div>
    <script type="text/javascript">
        $(function () {

            // language toggle
            var $languages = $(".languages .language");
            $languages.click(function (e) {
                e.preventDefault();
                var lang = $(this).data("lang");
                $languages.removeClass("selected");
                $(this).addClass("selected");

                $("pre code").hide();
                $("pre code." + lang).css("display", "block");
            });
            $("pre code." + $(".language.selected").data("lang")).css("display", "block");
        });
    </script>
    <script src="js/prism.js"></script>
</body>
</html>
