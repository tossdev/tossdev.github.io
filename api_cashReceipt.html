<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>토스 현금영수증 API</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="https://static.toss.im/tds/favicon/favicon.ico" />
    <link rel="icon" type="image/png" sizes="16x16" href="https://static.toss.im/tds/favicon/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="https://static.toss.im/tds/favicon/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="https://static.toss.im/tds/favicon/favicon-48x48.png" />
    <link rel="icon" type="image/png" sizes="196x196" href="https://static.toss.im/tds/favicon/favicon-196x196.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="https://static.toss.im/tds/favicon/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="https://static.toss.im/tds/favicon/apple-touch-icon-72x72.png" />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="https://static.toss.im/tds/favicon/apple-touch-icon-114x114.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="https://static.toss.im/tds/favicon/apple-touch-icon-120x120.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="https://static.toss.im/tds/favicon/apple-touch-icon-144x144.png"  
    />
    <link
      sizes="152x152"
      href="https://static.toss.im/tds/favicon/apple-touch-icon-152x152.png"fdsffsdf
    />
    <meta name="msapplication-TileImage" content="https://static.toss.im/tds/favicon/mstile-144x144.png" />

    <!-- stylesheets -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"
      integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ=="
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="css/prism.css" />
    <link rel="stylesheet" type="text/css" href="css/tossdev.css" />

    <!-- javascript -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"
      integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ=="
      crossorigin="anonymous"
    ></script>
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body id="docs" data-spy="scroll" data-target="#guide">
    <!-- Google Tag Manager -->
    <noscript
      ><iframe
        src="//www.googletagmanager.com/ns.html?id=GTM-TPTMLG"
        height="0"
        width="0"
        style="display:none;visibility:hidden"
      ></iframe
    ></noscript>
    <script>
      (function(w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', 'GTM-TPTMLG');
    </script>
  <!-- End Google Tag Manager -->
    <div id="guide">
      <div class="logo">
        <a href="index.html">
          <img class="logo-img" src="https://static.toss.im/tds/icon/svg/logo-only-icon.svg" alt="">
          <span>결제 연동 가이드</span>
        </a>
      </div>
        <ul class="menu nav">
            <h5>현금영수증 API</h5>
            <li>
                <a href="#intro">소개</a>
            </li>
            <h5>API 목록</h5>
            <li>
                <a href="#issue">현금 영수증 발급</a>
            </li>
            <li>
                <a href="#revoke">현금 영수증 취소</a>
            </li>
            <li>
                <a href="#info">현금 영수증 상태 확인 </a>
            </li>
            <li>
                <a href="#popupUri">현금 영수증 팝업 주소 전달 </a>
            </li>
        </ul>
    </div>
    <div id="api-docs">
      <div id="methods">
        <div class="languages">
          <a class="language selected" data-lang="php" href="#">PHP</a>
          <a class="language" data-lang="java" href="#">Java</a>
          <a class="language" data-lang="curl" href="#">curl</a>
          <a class="language" data-lang="python" href="#">Python</a>
          <a class="language" data-lang="ruby" href="#">Ruby</a>
          <a class="language" data-lang="aspnet" href="#">ASP</a>
        </div>
        <div class="method" id="intro">
          <div class="method-section clearfix">
            <div class="method-description">
              <h3>토스 현금영수증 API 소개</h3>
              <p>
               본 문서는 토스페이 결제 가맹점에서 현금영수증을 발급하거나 취소, 상태 확인 및 현금영수증 이미지 주소를 얻고자 할 때 사용할 API 에 대한 가이드를 제공합니다.<br>
               토스페이 결제 가맹점에서는 해당하는 현금영수증 API 를 이용하여 국세청으로 현금영수증을 등록 및 취소, 상태 확인 등을 할 수 있습니다.<br>
               이를 위해 토스페이에서는 토스페이먼츠(PG)를 통해 가맹점에게 현금영수증 API 를 제공하고,<br> 
	       토스페이먼츠(PG)를 통해 국세청으로 정상 등록이 되면 통상 2일 안에 국세청으로부터 동기화 과정을 거쳐서 현금영수증의 발급이 완료됩니다.
              </p>
            </div>
            </div>
          </div>
        <div class="method" id="issue">
          <div class="method-section clearfix">
            <div class="method-description">
              <h3>현금 영수증 발급</h3>
              <p>
               해당 결제가 status = PAY_COMPLETE 으로 완료되었을 때, 현금 영수증 발급이 가능합니다.
		<strong>* 주의 사항: 토스의 결제 금액과 현금영수증의 불일치를 막기 위해 - 발급 API 에서는 금액 정보를 파라미터로 받지 않습니다. 이미 결제 처리가 되어 토스 시스템에 기록된 과세 항목, 비과세 항목 등의 값을 바탕으로 현금영수증 발급이 처리됩니다.</strong>
              </p>
              <div class="info">
                <h4>endpoint</h4>
                <div class="field clearfix">
                  <div class="key">
                    (POST)
                  </div>
                  <div class="desc">
                    https://pay.toss.im/api/v2/issue-cash-receipt
                  </div>
                </div>
              </div>
              <div class="info">
                <h4>parameters</h4>
                <div class="field clearfix">
                  <div class="key">
                    apiKey
                  <span class="type">string <font color=#c25300>필수</font></span>
                  <span class="type">Max Length: 255 </span>
                  </div>
                  <div class="desc">
                   결제 가맹점의 apiKey<br/>
                   <span class="text-muted">apiKey 는 LIVE 값만 동작하며 TEST 값은 무시됩니다.
                  </div>
                </div>
		  <div class="field clearfix">
                  <div class="key">
                    payToken
                  <span class="type">string <font color=#c25300>필수</font></span>
                  <span class="type">Max Length: 255 </span>
                  </div>
                  <div class="desc">
                   결제 토큰 <br/>
                   <span class="text-muted">현금영수증 발급 대상 결제는 결제 완료(status = PAY_COMPLETE) 상태여야 합니다.<br></span>
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    cashReceiptKey
                  <span class="type">string <font color=#c25300>필수</font></span>
                  <span class="type">Max Length: 255 </span>
                  </div>
                  <div class="desc">
                    발급 주체를 식별할 수 있는 key 값<br/>
                    <span class="text-muted">ex) 개인의 경우 - 휴대폰번호<br/>
		                                 사업장의 경우 - 사업자등록번호<br></span>
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    cashReceiptKeyType
                  <span class="type">string <font color=#c25300>필수</font></span>
                  <span class="type">Max Length: 255 </span>
                  </div>
                  <div class="desc">
                    현금영수증 keyType<br/>
		  <br/>
                  <table class="table">
                    <tr>
                     <td>PHONE</td>
                      <td>전화번호</td>
                    </tr>
		     <tr>
                     <td>CORPORATE</td>
                      <td>사업자등록번호</td>
                    </tr>
		    <tr>
                     <td>CARD</td>
                      <td>카드번호</td>
                    </tr>
                  </table>
                   </div>
                  </div>
                <div class="field clearfix">
                  <div class="key">
                    cashReceiptPurpose
                  <span class="type">string <font color=#c25300>필수</font></span>
                  <span class="type">Max Length: 255 </span>
                  </div>
                  <div class="desc">
                    현금영수증 발급 목적<br/>
                    <br/>
                    <table class="table">
                      <tr>
                        <td>DEDUCTION</td>
                        <td>소득공제용</td>
                      </tr>
                      <tr>
                        <td>EVIDENCE</td>
                        <td>지출증빙용</td>
                      </tr>
                    </table>
                  </div>
		 </div>
		<div class="field clearfix">
                  <div class="key">
                    needSelfIssue
                  <span class="type">boolean</span>
                  <span class="type">Max Length: 5 </span>
                  </div>
                  <div class="desc">
                    자진발급 처리 여부<br/>
                    <span class="text-muted">자진발급 처리를 희망하지 않을 경우, needSelfIssue 파라미터는 전달 하지 않는다. (기본값 false)<br/>
                     * 단, cashReceiptKey, cashReceiptKeyType, cashReceiptPurpose 값들이 반드시 전달 되어야 한다.<br></span>
                   <br/>
                  <span class="text-muted"> 자진발급 처리 여부를 true 로 전달 할 경우, 자진발급 처리를 진행 할 수 있으며, 아래와 같이 자동 발행(2021년 01월부터 실행된 현금영수증 의무발행 정보에 의거)<br/>
                 * 식별번호(cashReceiptKey): 01000001234<br/>
                 * 현금영수증 타입(cashReceiptKeyType): PHONE (전화번호)<br/>
                 * 발급목적(cashReceiptPurpose): DEDUCTION (소득공제용)<br></span>
                 <br/>
                  </div>
                </div>
		 <div class="field clearfix">
                  <div class="key">
                    isCurrentCashReceiptKeyUsage
                  <span class="type">boolean</span>
                  <span class="type">Max Length: 5 </span>
                  </div>
                  <div class="desc">
                    토스 유저의 현재 현금영수증 식별번호로 발급 처리 여부<br/>
                    <span class="text-muted">해당 값을 true 로 전달 할 경우 식별번호를 보내지 않아도 토스가 저장하고 있는 유저의 현재 현금영수증 식별 번호로 발급 처리됩니다.(기본값 false)<br></span>
                  </div>
                </div>
              <div class="info">
                <h4>response (JSON)</h4>
		 <div class="field clearfix">
                  <div class="key">
                    status
                  </div>
                  <div class="desc">
                   http status code
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    code
                  </div>
                  <div class="desc">
                   http status code
                    <br />
                    <br />
                    <table class="table">
                      <tr>
                        <td>0</td>
                        <td>정상</td>
                      </tr>
                      <tr>
                        <td>그 외</td>
                        <td>에러</td>
                      </tr>
                    </table>
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    cashReceiptMgtKey
                  </div>
                  <div class="desc">
                    발급 요청된 현금영수증을 확인할 수 있는 관리번호 값 
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    supplyCost
                  </div>
                  <div class="desc">
                    공급가액 = 과세 금액 + 비과세 금액 <br>
                    supplyCost = amountTaxable + amountTaxFree
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    tax
                  </div>
                  <div class="desc">
                    부가세 <br>
                    tax = amountVat
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    serviceFee
                  </div>
                  <div class="desc">
                    봉사료 <br>
                    serviceFee = amountServiceFee
                  </div>
                </div>
                </div>
                    </div>
                     <div class="method-example">
                        <div class="title">Definition</div>
                        <pre><code class="language-bash always-visible">POST https://pay.toss.im/api/v2/issue-cash-receipt</code></pre>
                        <div class="title">Example Request</div>
                        <pre><code class="curl language-bash">curl https://pay.toss.im/api/v2/issue-cash-receipt \
    -H "Content-Type: application/json" \
    -d '{
    "apiKey": "example_api_key",
    "payToken": "example_payToken",
    "cashReceiptKey": "01001230123",
    "cashReceiptKeyType": "PHONE",
    "cashReceiptPurpose": "DEDUCTION"
        }'</code><code class="java language-java">import java.nio.charset.StandardCharsets;

URL url = null;
URLConnection connection = null;
StringBuilder responseBody = new StringBuilder();
try {
	url = new URL("https://pay.toss.im/api/v2/issue-cash-receipt");
	connection = url.openConnection();
	connection.addRequestProperty("Content-Type", "application/json");
	connection.setDoOutput(true);
	connection.setDoInput(true);

	org.json.simple.JSONObject jsonBody = new JSONObject();
	jsonBody.put("apiKey", "example_api_key");
    	jsonBody.put("payToken", "example_payToken");
    	jsonBody.put("cashReceiptKey", "01001230123");
    	jsonBody.put("cashReceiptKeyType", "PHONE");  
    	jsonBody.put("cashReceiptPurpose", "DEDUCTION");

	BufferedOutputStream bos = new BufferedOutputStream(connection.getOutputStream());
	<!--bos.write(jsonBody.toJSONString().getBytes());-->
    bos.write(jsonBody.toJSONString().getBytes(StandardCharsets.UTF_8));
	bos.flush();
	bos.close();

	<!--BufferedReader br = new BufferedReader(new InputStreamReader(connection.getInputStream()));-->
    BufferedReader br = new BufferedReader(new InputStreamReader(connection.getInputStream(), StandardCharsets.UTF_8));
	String line = null;
	while ((line = br.readLine()) != null) {
		responseBody.append(line);
	}
	br.close();
} catch (Exception e) {
	responseBody.append(e);
}
System.out.println(responseBody.toString());</code><code class="php language-php">$arrayBody = array();
$arrayBody["apiKey"] = "example_api_key";
$arrayBody["payToken"] = "example_payToken";
$arrayBody["cashReceiptKey"] = "01001230123";
$arrayBody["cashReceiptKeyType"] = "PHONE";
$arrayBody["cashReceiptPurpose"] = "DEDUCTION";
$jsonBody = json_encode($arrayBody);

$ch = curl_init('https://pay.toss.im/api/v2/issue-cash-receipt');
curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
curl_setopt($ch, CURLOPT_POSTFIELDS, $jsonBody);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HTTPHEADER, array(
    'Content-Type: application/json',
    'Content-Length: ' . strlen($jsonBody))
);

$result = curl_exec($ch);
curl_close($ch);

echo "Response: ".$result;</code><code class="aspnet language-aspnet">Dim data, httpRequest, postResponse

data = "apiKey=example_api_key"
data = data & "&payToken=example_payToken"
data = data & "&cashReceiptKey=01001230123"
data = data & "&cashReceiptKeyType=PHONE"
data = data & "&cashReceiptPurpose=DEDUCTION"

Set httpRequest = Server.CreateObject("MSXML2.ServerXMLHTTP")
httpRequest.Open "POST", "https://pay.toss.im/api/v2/issue-cash-receipt", False
httpRequest.SetRequestHeader "Content-Type", "application/json"
httpRequest.Send data

postResponse = httpRequest.ResponseText

Response.Write postResponse</code><code class="python language-python">import urllib, urllib2

url = "https://pay.toss.im/api/v2/issue-cash-receipt"
params = {
    "orderNo": "1",
    "amount": 10000,
    "amountTaxFree": 0,
    "productDesc":"테스트 결제",
    "apiKey": "sk_test_w5lNQylNqa5lNQe013Nq",
    "autoExecute": true,
    "resultCallback": "http://YOUR-SITE.COM/callback",
    "callbackVersion": "V2",
    "retUrl": "http://YOUR-SITE.COM/ORDER-CHECK?orderno=1",
    "retCancelUrl": "http://YOUR-SITE.COM/close"
}

response = urllib.urlopen(url, urllib.urlencode(params))
print(response.read())</code><code class="ruby language-ruby">require 'net/http'
require 'json'

uri = URI.parse("https://pay.toss.im/api/v2/issue-cash-receipt")

params = {
        "apiKey" => "example_api_key",
        "payToken" => "example_payToken",
        "cashReceiptKey" => "01001230123",
        "cashReceiptKeyType" => "PHONE",
        "cashReceiptPurpose": "DEDUCTION"
}

http = Net::HTTP.new(uri.host, uri.port)
http.use_ssl = true
request = Net::HTTP::Post.new(uri.path)
request.set_form_data(params)
response = http.request(request)

p JSON.parse(response.body)</code></pre>
                        <div class="title">Example Response</div>
                        <pre><div><code style="border:none;box-shadow:none;" class="language-javascript always-visible">{"status":200,"code":0,"cashReceiptMgtKey":"123456-123456","supplyCost":909,"tax":91,"serviceFee":0}
                        </code></div></pre>
                    </div>
                </div>
            </div>

		
    <script type="text/javascript">
        $(function () {

            // language toggle
            var $languages = $(".languages .language");
            $languages.click(function (e) {
                e.preventDefault();
                var lang = $(this).data("lang");
                $languages.removeClass("selected");
                $(this).addClass("selected");

                $("pre code").hide();
                $("pre code." + lang).css("display", "block");
            });
            $("pre code." + $(".language.selected").data("lang")).css("display", "block");
        });
    </script>
    <script src="js/prism.js"></script>
</body>

</html>
