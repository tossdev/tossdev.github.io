<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>토스 현금영수증 API</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="https://static.toss.im/tds/favicon/favicon.ico" />
    <link rel="icon" type="image/png" sizes="16x16" href="https://static.toss.im/tds/favicon/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="https://static.toss.im/tds/favicon/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="https://static.toss.im/tds/favicon/favicon-48x48.png" />
    <link rel="icon" type="image/png" sizes="196x196" href="https://static.toss.im/tds/favicon/favicon-196x196.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="https://static.toss.im/tds/favicon/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="https://static.toss.im/tds/favicon/apple-touch-icon-72x72.png" />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="https://static.toss.im/tds/favicon/apple-touch-icon-114x114.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="https://static.toss.im/tds/favicon/apple-touch-icon-120x120.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="https://static.toss.im/tds/favicon/apple-touch-icon-144x144.png"  
    />
    <link
      sizes="152x152"
      href="https://static.toss.im/tds/favicon/apple-touch-icon-152x152.png"fdsffsdf
    />
    <meta name="msapplication-TileImage" content="https://static.toss.im/tds/favicon/mstile-144x144.png" />

    <!-- stylesheets -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"
      integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ=="
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="css/prism.css" />
    <link rel="stylesheet" type="text/css" href="css/tossdev.css" />

    <!-- javascript -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"
      integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ=="
      crossorigin="anonymous"
    ></script>
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body id="docs" data-spy="scroll" data-target="#guide">
    <!-- Google Tag Manager -->
    <noscript
      ><iframe
        src="//www.googletagmanager.com/ns.html?id=GTM-TPTMLG"
        height="0"
        width="0"
        style="display:none;visibility:hidden"
      ></iframe
    ></noscript>
    <script>
      (function(w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', 'GTM-TPTMLG');
    </script>
  <!-- End Google Tag Manager -->
    <div id="guide">
      <div class="logo">
        <a href="index.html">
          <img class="logo-img" src="https://static.toss.im/tds/icon/svg/logo-only-icon.svg" alt="">
          <span>결제 연동 가이드</span>
        </a>
      </div>
        <ul class="menu nav">
            <h5>결제 정산 API</h5>
            <li>
                <a href="#intro">소개</a>
            </li>
	    <h5>용어</h5>
            <li>
                <a href="#terms">용어 및 정의</a>
            </li>
            <h5>API 목록</h5>
            <li>
                <a href="#settlementDetail">정산 API</a>
            </li>
        </ul>
    </div>
    <div id="api-docs">
      <div id="methods">
        <div class="languages">
          <a class="language selected" data-lang="php" href="#">PHP</a>
          <a class="language" data-lang="java" href="#">Java</a>
          <a class="language" data-lang="curl" href="#">curl</a>
          <a class="language" data-lang="python" href="#">Python</a>
          <a class="language" data-lang="ruby" href="#">Ruby</a>
          <a class="language" data-lang="aspnet" href="#">ASP</a>
        </div>
        <div class="method" id="intro">
          <div class="method-section clearfix">
            <div class="method-description">
              <h3>토스 정산 API 소개 </h3>
              <p>
               토스 결제 서비스를 통한 매출과 정산 금액 확인을 위한 API 입니다.</br>
               페이징 개념을 적용하였고 페이징의 단위는 1,000 건으로 다음 페이징이 존재하면 nextCursor 라는 응답값이 리턴됩니다. 그 후 nextCursor 를 포함하여 호출하면 바로 다음의 페이징 데이터가 리턴됩니다.
              </p>
            </div>
            <div class="method-example">
              <pre></pre>
            </div>
          </div>
        </div>
        <div class="method" id="terms">
          <div class="method-section clearfix">
            <div class="method-description">
              <h3>용어</h3>
              <div class="info">
                <h4>용어 및 정의</h4>
                <div class="field clearfix">
                  <div class="key">
                    지급일
                  </div>
                  <div class="desc">
                    결제 금액을 가맹점의 결제 계좌로 입금한 날입니다.
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    거래 승인일
                  </div>
                  <div class="desc">
                    결제, 환불 등 거래가 실제로 일어난 날입니다.
                  </div>
                </div>
              </div>
            </div>
            <div class="method-example">
              <pre>
              <code class="curl">
              </code>
              <code class="java">
              </code>
              <code class="pho">
              </code>
            </pre>
            </div>
          </div>
        </div>
        <div class="method" id="settlementDetail">
          <div class="method-section clearfix">
            <div class="method-description">
              <h3>정산 API</h3>
              <div class="info">
                <h4>endpoint</h4>
                <div class="field clearfix">
                  <div class="key">
                    (POST)
                  </div>
                  <div class="desc">
                    https://pay.toss.im/pay/api/v2/settlement-details
                  </div>
                </div>
              </div>
              <div class="info">
                <h4>parameters</h4>
                <div class="field clearfix">
                  <div class="key">
                    apiKey
                    <span class="type">string</span>
                    <span class="required"></span>
                  </div>
                  <div class="desc">
                    가맹점 key<br/>
                    Test apiKey도 입력은 가능하나 테스트 결제는 실제 지급되지 않기 때문에 정산 대상이 아니라서 수수료 계산(0원)이나 지급일자(빈값) 등 계산을 건너뛰게 됩니다.
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    dateType
                    <span class="type">string</span>
                    <span class="required"></span>
                  </div>
                  <div class="desc">
                    조회 시 기준 날짜의 형태 <br />
                    <br />
                    <table class="table">
                      <tr>
                        <td>DUE</td>
                        <td>지급일 (정산 계좌에 입금된 또는 입금될 날짜)</td>
                      </tr>
                      <tr>
                        <td>SETTLE</td>
                        <td>거래 승인일 (유저가 결제한 시점의 날짜) </td>
                      </tr>
                    </table>
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    baseDate
                    <span class="type">string</span>
                    <span class="required"></span>
                  </div>
                  <div class="desc">
                    조회 하고자 하는 날짜 (yyyyMMdd)
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    payMethod
                    <span class="type">string</span>
                  </div>
                  <div class="desc">
                    조회 하고자 하는 결제수단 (보내지 않거나  null 로 보내면 모든 결제수단에 대해 응답)<br />
                    <br />
                    <table class="table">
                      <tr>
                        <td>TOSS_MONEY</td>
                        <td>토스머니</td>
                      </tr>
                      <tr>
                        <td>CARD</td>
                        <td>카드</td>
                      </tr>
		       <tr>
                        <td>RESELLER_CARD</td>
                        <td>리셀러 카드(리셀러 가맹점에만 해당)</td>
                      </tr>
                    </table>
                  </div>
                </div>
		 <div class="field clearfix">
                  <div class="key">
                    nextCursor
                    <span class="type">string</span>
                  </div>
                  <div class="desc">
                    호출할 페이징의 cursor 값을 나타냅니다.  정산 API 호출 후 리턴되는 응답값을 다음의 정산 API 호출 시 파라미터로 사용하면 됩니다.</br> 
                    해당 파라미터가 추가되지 않고 API 가 호출되면 무조건 첫 페이징 데이터가 리턴됩니다. (index : 0 ~ 999)
                  </div>
                </div>
              </div>
		<div class="info">
                <h4>OPTION PARAMETERS</h4>
		 <div class="field clearfix">
                  <div class="key">
                    includeSettleDateTime
                  </div>
                  <div class="desc">
                   응답으로 '거래 처리 일시' 가 필요한 경우 URI query string 으로 includeSettleDateTime=true 를 넘겨주시면 됩니다.</br>
                   호출 URI 예시) https://pay.toss.im/pay/api/v2/settlement-details?includeSettleDateTime=true
                  </div>
                </div>
              </div>
              <div class="info">
                <h4>RESPONSE</h4>
                <div class="field clearfix">
                  <div class="key">
                    transactionList
		 <span class="type">string</span>
                  </div>
                  <div class="desc">
                   정산 내역 리스트 - 최대 1000 개<br/>
                    <br/>
                   <table class="table">
                      <tr>
                        <td>transactionType: 거래종류 <br/>
			    <li>PAY: 결제</li>
			    <li>REFUND: 환불</li>
			</td>
			 </tr>
			<tr>
                        <td>transactionId: 거래 고유 번호 <br/>
			    <li>결제 및 환불 시의 거래 고유 번호</li>
			    <li>동일 결제 건의 부분 환불을 여러번 할 때, 각각의 부분 환불건을 구분하기 위함 </li>
			</td>
                      </tr>
                      <tr>
                        <td>settleDate: 거래 승인일</td>
                      </tr>
                      <tr>
                        <td>dueDate: 정산일 (지급일)</td>
                      </tr>
		       <tr>
                        <td>payToken: 토스 결제 토큰</td>
                      </tr>
		       <tr>
                        <td>orderNo: 가맹점의 상품 주문번호</td>
                      </tr>
		       <tr>
                        <td>productDesc: 상품 설명</td>
                      </tr>
			<tr>
                        <td>payMethod : 결제 수단 <br/>
			    <li>TOSS_MONEY : 토스머니</li>
			    <li>CARD : 카드 </li>
			    <li>RESELLER_CARD : 리셀러 카드</li>
			</td>
                      </tr>
			 <tr>
                        <td>amount: 금액(결제는 '+', 환불은 '-'로 표시됨)</td>
                      </tr>
			 <tr>
                        <td>fee: 수수료(수수료 부과는 '-', 전액 환불 등 사유로 수수료를 돌려드리는 경우 '+'로 표시됨)</td>
                      </tr>
			 <tr>
                        <td>vat: 부가세(부가세 부과는 '-', 전액 환불 등 사유로 부가세를 돌려드리는 경우 '+'로 표시됨)</td>
                      </tr>
			 <tr>
                        <td>feeVatSum: 수수료 + 부가세</td>
                      </tr>
                    </table>
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    nextCursor
		 <span class="type">string</span>
			</div>
                  <div class="desc">
                   API 호출 이후 다음 페이징 영역에 데이터가 존재하면 커서 값이 리턴됩니다. <br/>
                   마지막 페이징이었다면 빈 스트링이 리턴됩니다. 
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    totalAmount
		<span class="type">Integer</span>
			</div>
                  <div class="desc">
                    총 금액 합산 <br/> 
		  (페이징별 합산금액이 아닌) 조회된 전체 건에 대한 총 금액 합산 
                  </div>
                </div>
		<div class="field clearfix">
                  <div class="key">
                    totalFee
		<span class="type">Integer</span>
			</div>
                  <div class="desc">
                    총 수수료 합산 <br/> 
		   (페이징별 합산금액이 아닌) 조회된 전체 건에 대한 총 수수료 합산 
                  </div>
                </div>
		      <div class="field clearfix">
                  <div class="key">
                    totalVat
		<span class="type">Integer</span>
			      </div>
                  <div class="desc">
                    총 부가세 합산 <br/> 
                   (페이징별 합산금액이 아닌) 조회된 전체 건에 대한 총 부가세 합산 
                  </div>
                </div>
		      <div class="field clearfix">
                  <div class="key">
                    totalFeeVatSum
		<span class="type">Integer</span>
			      </div>
                  <div class="desc">
                    총 수수료 + 부가세의 합산 (totalFee + totalVat) <br/>
                   (페이징별 합산금액이 아닌) 조회된 전체 건에 대한 총 수수료+부가세 합산 
                  </div>
                </div>
                <div class="field clearfix">
                  <div class="key">
                    settleDateTime
                  <span class="type">string</span>
			</div>
                  <div class="desc">
                  거래 처리 일시<br/>
                  최종 거래 상태가 승인(PAY) 일 경우는 승인 처리 시각, 환불(REFUND) 일 경우는 환불 처리 시각이 yyyyMMddHHmmss 형태로 리턴됩니다.<br/>
                   단, includeSettleDateTime=true 를 포함해서 호출한 경우에만 리턴합니다.
                  </div>
                </div>
            </div>
	</div>
            <div class="method-example">
              <div class="title">Definition</div>
              <pre><code class="language-bash always-visible">POST https://pay.toss.im/api/v1/settlementDetails</code></pre>
              <div class="title">Example Request</div>
              <pre><code class="curl language-bash">curl https://pay.toss.im/api/v1/settlementDetails \
    -H "Content-Type: application/json" \
    -d '{
        "apiKey":"sk_test_w5lNQylNqa5lNQe013Nq",
        "mode":"DUE",
        "date":"20160601",
        "type":"JSON"
        }'</code><code class="java language-java">URL url = null;
URLConnection connection = null;
StringBuilder responseBody = new StringBuilder();
try {
	url = new URL("https://pay.toss.im/api/v1/settlementDetails");
	connection = url.openConnection();
	connection.addRequestProperty("Content-Type", "application/json");
	connection.setDoOutput(true);
	connection.setDoInput(true);

	org.json.simple.JSONObject jsonBody = new JSONObject();
	jsonBody.put("apiKey", "sk_test_w5lNQylNqa5lNQe013Nq");
	jsonBody.put("mode", "DUE");
    jsonBody.put("date", "20160601");
	jsonBody.put("type", "JSON");

	BufferedOutputStream bos = new BufferedOutputStream(connection.getOutputStream());
	bos.write(jsonBody.toJSONString().getBytes());
	bos.flush();
	bos.close();

	BufferedReader br = new BufferedReader(new InputStreamReader(connection.getInputStream()));
	String line = null;
	while ((line = br.readLine()) != null) {
		responseBody.append(line);
	}
	br.close();
} catch (Exception e) {
	responseBody.append(e);
}
System.out.println(responseBody.toString());</code><code class="php language-php">$arrayBody = array();
$arrayBody["apiKey"] = "sk_test_w5lNQylNqa5lNQe013Nq";
$arrayBody["mode"] = "DUE";
$arrayBody["date"] = "20160601";
$arrayBody["type"] = "JSON";
$jsonBody = json_encode($arrayBody);

$ch = curl_init('https://pay.toss.im/api/v1/settlementDetails');
curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
curl_setopt($ch, CURLOPT_POSTFIELDS, $jsonBody);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HTTPHEADER, array(
    'Content-Type: application/json',
    'Content-Length: ' . strlen($jsonBody))
);

$result = curl_exec($ch);
curl_close($ch);

echo "Response: ".$result;</code><code class="aspnet language-aspnet">Dim data, httpRequest, postResponse

data = "apiKey=sk_test_w5lNQylNqa5lNQe013Nq"
data = data & "&mode=DUE"
data = data & "&date=20160601"
data = data & "&type=JSON"

Set httpRequest = Server.CreateObject("MSXML2.ServerXMLHTTP")
httpRequest.Open "POST", "https://pay.toss.im/api/v1/settlementDetails", False
httpRequest.SetRequestHeader "Content-Type", "application/x-www-form-urlencoded"
httpRequest.Send data

postResponse = httpRequest.ResponseText

Response.Write postResponse</code><code class="python language-python">import urllib, urllib2

url = "https://pay.toss.im/api/v1/settlementDetails"
params = {
    "apiKey": "sk_test_w5lNQylNqa5lNQe013Nq",
    "mode":"DUE",
    "date":"20160601",
    "type":"JSON"
}

response = urllib.urlopen(url, urllib.urlencode(params))
print(response.read())</code><code class="ruby language-ruby">require 'net/http'
require 'json'

uri = URI.parse("https://pay.toss.im/api/v1/settlementDetails")

params = {
        "apiKey" => "sk_test_w5lNQylNqa5lNQe013Nq",
        "mode" => "DUE",
        "date" => "20160601",
        "type" => "JSON"
}

http = Net::HTTP.new(uri.host, uri.port)
http.use_ssl = true
request = Net::HTTP::Post.new(uri.path)
request.set_form_data(params)
response = http.request(request)

p JSON.parse(response.body)</code></pre>
              <div class="title">Example Response (JSON)</div>
              <pre><code style="border:none;box-shadow:none;" class="language-javascript always-visible">[{
    "transactionType": "PAY",
	"productDesc": "토스모자",
	"amount": 5500,
	"orderNo": "toss_orderNo_1234",
    "payMethod": "TOSS_MONEY",
	"dueDate": "20180530",
	"fee": -400,
	"vat": -40,
	"settleDate": "20180529",
	"payToken": "1234abcdef"
}, {
	"transactionType": "REFUND",
	"productDesc": "토스모자",
	"amount": -5300,
    "orderNo": "toss_orderNo_1234",
    "payMethod": "TOSS_MONEY",
	"dueDate": "20180530",
	"fee": -400,
	"vat": -40,
	"settleDate": "20180529",
	"payToken": "1235abcdef",
    "tossChargeAmount": 0,
    "rewardReturnAmount": -200
},
{....}
]</code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      $(function() {
        // language toggle
        var $languages = $('.languages .language');
        $languages.click(function(e) {
          e.preventDefault();
          var lang = $(this).data('lang');
          $languages.removeClass('selected');
          $(this).addClass('selected');

          $('pre code').hide();
          $('pre code.' + lang).css('display', 'block');
        });
        $('pre code.' + $('.language.selected').data('lang')).css('display', 'block');
      });
    </script>
    <script src="js/prism.js"></script>
  </body>
</html>
